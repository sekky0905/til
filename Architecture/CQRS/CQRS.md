# CQRS

## [CQRS Documents by Greg Young](http://www.minato.tv/cqrs/cqrs_documents_jp.pdf)メモ

### ステレオタイプなアーキテクチャ

#### アプリケーションサーバ

- データストレージから分離してビジネスロジックに集中するアーキテクチャが流行ってる

#### クライアントの対話

- クライアントとの対話は、DTOを使用したインタラクティブなやりとり
    - クライアント側でデータを変更→サーバに送信
    - サーバはクライアントから受け取ったDTOをオブジェクトに結びつける
    - DBに格納
    - クライアントからの呼び出しによって、DBのデータをDTOにして返す
- ドメイン駆動設計
    - ドメインオブジェクトに振る舞い(ドメインロジック)を持たせるべきであるが、ドメインオブジェクトは振る舞いを持たない
    - 結局 DTO とマッピングを行うデータの塊のようなものになってしまう
        - ドメインロジックが存在しない場合や、クライアント側に存在する場合、ユーザーの頭の中に存在する場合などがある
        - こういうアーキテクチャは、システムの色んな箇所でデータを編集し、複雑なタスクを完了するための命令が存在する傾向がある

### タスクベース・ユーザインタフェース

- ステレオタイプなアーキテクチャでは、ユーザの目的が失われるという問題点がある
- クライアントとアプリケーションサーバ間の通信は、DTO のやりとりが中心になる
    - ドメインに振る舞いは持つことができない
    - サーバ側には振る舞い (≒ ビジネスロジック)が存在しない
        - クライアントの頭の中とかに存在する
- ユーザーは、データを編集したりするワークフローを持っている
    - 以下のような場合、ソフトウェアは正当な情報を提供することができるか
        - ユーザーが脳内に持っているプロセスのステップを見落とす
        - 異なることを実行する様々なソフトウェアユーザを抱えている
    - 上記のような問題を扱う方法の1つが、DTOの単なるやりとりのアーキテクチャを脱却すること
- 脱却するアーキテクチャ
    - 既存のDTOのやりとりのアーキテクチャとの類似点
        - クライアントがサーバに問い合わせる
        - サーバから指定されたデータの DTO を返す
        - クライアント側で表示する
        - ユーザーとインタラクティブなやりとりが続く
    - 異なる点として、クライアントからサーバにデータを送信する際には、単純な DTO の送信ではなく、ユーザーが何をしたいかという意図もメッセージとして送信する


